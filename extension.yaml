name: loric-edu-analytics
version: 0.0.1
specVersion: v1beta
displayName: LoricEdu
description: Analytics Aggregator for Loric Edu
icon: icon.png
license: Apache-2.0
sourceUrl: https://github.com/srikantloric/New-folder--2-
billingRequired: true

author:
  authorName: Loric Softwares
  email: extensions@loricsoftwares.com
  url: https://loricsoftwares.com/

params:
  - param: PROJECT_ID
    label: Firebase Project ID
    description: Project ID where the payments collection exists
    type: string
  - param: ENABLE_ANALYTICS
    label: Enable Analytics Aggregation
    description: Set to true to enable analytics logic, false to disable.
    type: select
    options:
      - label: Enabled
        value: true
      - label: Disabled
        value: false
    default: true

resources:
  - name: onPaymentAdd
    type: firebaseextensions.v1beta.function
    properties:
      eventTrigger:
        eventType: providers/cloud.firestore/eventTypes/document.create
        resource: projects/${PROJECT_ID}/databases/(default)/documents/MY_PAYMENTS/{paymentId}
      entryPoint: onPaymentAdd
      runtime: nodejs20

  - name: onPaymentDelete
    type: firebaseextensions.v1beta.function
    properties:
      eventTrigger:
        eventType: providers/cloud.firestore/eventTypes/document.delete
        resource: projects/${PROJECT_ID}/databases/(default)/documents/MY_PAYMENTS/{paymentId}
      entryPoint: onPaymentDelete
      runtime: nodejs20
  - name: scheduledExecutiveReport
    type: firebaseextensions.v1beta.function
    description: Runs every day at 6 PM IST, checks toggle from Firestore, and sends SMS via Fast2SMS.
    properties:
      scheduleTrigger:
        schedule: '0 18 * * *'

roles:
  - role: datastore.owner
    reason: The extension needs to update aggregated analytics in Firestore.

  - role: datastore.user
    reason: The extension needs to read documents from Firestore.
